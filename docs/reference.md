# 参数手册 (Reference)

本文档详细介绍了 `gonc` 的命令行参数及其背后的工作原理。为了便于查阅，参数已按照功能模块进行分类。

!!! info "命令行格式"
    ```bash
    gonc [选项] <目标主机> <目标端口>
    ```

---

## 📡 基础连接与网络层

控制最基本的网络连接行为，包括 IP 版本选择、监听模式和代理设置。

| 参数 | 说明 | 原理与备注 |
| :--- | :--- | :--- |
| **`-l`** | **监听模式 (Listen)**<br>作为服务端等待连接。 | 类似于传统的 `nc -l`。开启后 `gonc` 会绑定本地端口等待入站请求。 |
| **`-k`, `-keep-open`** | **保持监听**<br>客户端断开后不退出。 | 默认情况下，连接断开后 `gonc` 会结束进程。此选项使其行为更像一个守护进程 (Daemon)。 |
| **`-u`** | **UDP 模式**<br>使用 UDP 协议而非 TCP。 | 适用于无连接的数据传输测试（如 DNS、流媒体）。 |
| **`-4`, `-6`** | **强制 IPv4 / IPv6** | 强制 DNS 解析和连接建立时仅使用指定的 IP 协议栈。 |
| **`-x <ip:port>`** | **前置代理**<br>通过代理连接目标。 | 格式支持 `socks5://` 或 `http://` (Connect)。原理是在建立连接前先与代理握手。支持 `-tls` 和 `-psk` 组合使用。 |
| **`-x2 <string>`** | **备用代理** | 当 `-p2p` 直连失败时，自动回退使用的代理地址。 |

---

## ⚡ P2P 与 NAT 穿透

`gonc` 的核心亮点，用于在没有公网 IP 的两台内网机器间建立直连隧道。

| 参数 | 说明 | 原理与备注 |
| :--- | :--- | :--- |
| **`-p2p <Key>`** | **P2P 会话密钥**<br>开启 P2P 模式。 | **原理**：利用 UDP Hole Punching (打洞) 技术。双方需持有相同的 Key。`gonc` 会尝试直接穿越 NAT；如果失败，可回退到中继模式。 |
| **`-nat-checker`** | **NAT 类型检测** | 检测当前网络的 NAT 类型（如 Full Cone, Symmetric 等）。这对评估 P2P 成功率至关重要。 |
| **`-stun`** | **使用 STUN** | 使用 STUN 协议发现本机的公网 IP 和映射端口，辅助打洞。 |
| **`-stunsrv <list>`** | **STUN 服务器列表** | 指定 STUN 服务器。支持 `,` 分隔或 `@file` 文件导入。默认内置了 Google/Cloudflare 等公共服务。 |
| **`-mqttsrv <string>`** | **MQTT 信令服务器** | **原理**：P2P 建立前需要交换双方的公网信息（SDP）。`gonc` 使用 MQTT 作为一个轻量级的“死信箱”来交换这些元数据，从而无需自建复杂的协调服务器。 |
| **`-auto-psk`** | **自动密钥协商** | 使用 MQTT 通道配合 ECDHE (椭圆曲线) 算法自动协商加密密钥，无需手动指定 `-psk`。 |

---

## 🚀 传输协议与性能优化

针对高丢包、高延迟网络环境的优化选项。

| 参数 | 说明 | 原理与备注 |
| :--- | :--- | :--- |
| **`-kcp`** | **KCP 协议**<br>使用 KCP 加速传输。 | **原理**：KCP 是基于 UDP 的 ARQ 协议。它以比 TCP 浪费 10%-20% 带宽的代价，换取低延迟和抗丢包能力。适合跨国或不稳定的网络。 |
| **`-kcp-window-size`** | **KCP 窗口大小** | 调整发送/接收窗口。默认为 1500。数值越大，吞吐量潜力越大，但内存消耗越高。 |
| **`-mux-engine`** | **多路复用引擎**<br>`yamux` 或 `smux`。 | **原理**：在一条物理连接（TCP/UDP）中虚拟出多个逻辑流（Stream）。这解决了 TCP 握手延迟问题，并防止队头阻塞。默认 `smux`。 |
| **`-no-compress`** | **禁用压缩** | HTTP 下载时默认开启 gzip 压缩。如果在传输由于已经压缩过的文件（如 zip, jpg），建议开启此项以节省 CPU。 |

---

## 🛠 内置服务模块 (-e)

无需编写脚本，直接将 `gonc` 变为特定的网络服务。

!!! abstract "工作原理"
    `-e` 参数不仅像 `nc` 那样支持执行 shell 命令，还内置了完整的 Go 语言编写的服务处理函数。

| 参数 | 对应的命令 | 功能描述 |
| :--- | :--- | :--- |
| `-e :sh` | `shell` | **远程 Shell**。将连接的 stdin/stdout 重定向到系统的 shell (cmd.exe 或 /bin/sh)。 |
| `-e :nc` | `netcat` | **标准 Netcat**。仅进行标准输入输出的转发。 |
| `-e :s5s` | `SOCKS5` | **SOCKS5 代理服务器**。将 `gonc` 变为一个标准的 SOCKS5 代理，支持 UDP Associate。 |
| `-e :httpserver` | `http` | **HTTP 文件服务器**。快速共享当前目录下的文件。 |
| `-e :mux` | `mux` | **多路复用代理**。配合客户端的 `-link` 参数使用，实现单端口承载多服务。 |

**高级用法示例：**
```bash
# 启动一个带用户认证的 SOCKS5 代理
gonc -l 1080 -auth "user:pass" -e ":s5s"